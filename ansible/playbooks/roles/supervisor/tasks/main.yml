#Marco Boretto <marco.boretto@cern.ch> 2019
---
- name: Open port 9001 on firewalld for supervisor web/XML-RPC Interface
  firewalld:
    zone: public
    port: 9001/tcp
    permanent: true
    state: enabled
  notify:
    - restart firewalld
  when: ansible_distribution == 'CentOS' or ansible_distribution == 'Red Hat Enterprise Linux'

- name: Install supervisor Centos
  yum:
    name: supervisor
    state: present
  when: ansible_distribution == 'CentOS' or ansible_distribution == 'Red Hat Enterprise Linux'

- name: Copy supervisor service configuration file
  copy:
    src: usr/lib/systemd/system/supervisor.service
    dest: /usr/lib/systemd/system/
  notify:
    - restart supervisor
  when: ansible_distribution == 'CentOS' or ansible_distribution == 'Red Hat Enterprise Linux'

- name: Copy supervisor gui configuration file
  copy:
    src: etc/supervisord.d/web-gui.ini
    dest: /etc/supervisord.d/
  notify:
    - restart supervisor
  when: ansible_distribution == 'CentOS' or ansible_distribution == 'Red Hat Enterprise Linux'

- name: Enabling supervisor service
  service:
    name: supervisor
    enabled: yes

- name: Start supervisor.service
  service:
    name: supervisor
    state: started

