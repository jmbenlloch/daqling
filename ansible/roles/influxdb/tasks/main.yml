- name: Install InfluxDB
  yum:
    name: https://dl.influxdata.com/influxdb/releases/influxdb-1.7.6.x86_64.rpm

- name: Open port 8086 on firewalld for InfluxDB's HTTP API
  firewalld:
    zone: public
    port: 8086/tcp
    permanent: true
    state: enabled
  notify:
    - restart firewalld
  when: ansible_distribution == 'CentOS' or ansible_distribution == 'Red Hat Enterprise Linux'

- name: Enable and restart InfluxDB service
  systemd:
    name: influxdb
    enabled: yes
    daemon_reload: yes
    state: restarted

- name: Install influxdb python package
  pip:
    name: "influxdb"

- name: Install influxdb python3 package
  pip:
    name: "influxdb"
    executable: pip3

- name: Create DAQlingMetrics database
  influxdb_database:
    hostname: "localhost"
    database_name: "DAQlingMetrics"

