- name: Clone nlohmann/json
  git:
    repo: https://github.com/nlohmann/json.git
    dest: /opt/json
    version: v3.6.1

- name: Clone gabime/spdlog
  git: 
    repo: https://github.com/gabime/spdlog.git
    dest: /opt/spdlog
    version: v1.3.1

- name: Clone whoshuu/cpr
  git:
    repo: https://github.com/whoshuu/cpr
    dest: /opt/cpr
    version: 1.3.0

- name: Clone zeromq/libzmq
  git:
    repo: https://github.com/zeromq/libzmq.git
    dest: /opt/libzmq
    version: v4.3.2

- name: nemequ/hedley
  git:
    repo: https://github.com/nemequ/hedley.git
    dest: /opt/hedley
    version: v9

- file:
    path: /opt/cpr/build
    state: directory

- file:
    path: /opt/libzmq/build
    state: directory

- name: Run cmake3 in cpr
  cmake: 
    source_dir: /opt/cpr
    binary_dir: /opt/cpr/build
    target: cpr
    build_type: Release
    executable: /usr/bin/cmake3
    cache_vars: {"USE_SYSTEM_CURL": "ON", "BUILD_CPR_TESTS": "OFF", "CMAKE_CXX_FLAGS": "-fPIC"}

- name: Run cmake3 in zmq
  cmake:
    source_dir: /opt/libzmq
    binary_dir: /opt/libzmq/build
    target: libzmq
    build_type: Release
    executable: /usr/bin/cmake3

    # Build libzmq with libsodium instead of the built-in tweetnacl.
    # Fixed zmq::context_t dtor on daqpy `down` command when libzmq curve security is enabled.
    cache_vars: {"WITH_LIBSODIUM": "ON"}
